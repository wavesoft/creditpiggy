/*! CreditPiggy API v0.1 | Ioannis Charalampidis, Citizen Cyberlab EU Project | GNU GPL v2.0 License */
(window.define==undefined?function(b,a){window.CreditPiggy=a($||jQuery)}:window.define)(["jquery"],function(a){if(!a){console.error("CreditPiggy: jQuery must available in order to use creditpiggy.js!");return null}var b={version:"0.1",apiURL:"//creditpiggy.cern.ch/api",profile:null,__callbacks:{},__session:null};b.__api=function(d,c,e){a.ajax({url:this.apiURL+"/"+d+".json",contentType:"json",data:c||{version:this.version},method:"GET"}).done((function(g,h,f){if(e){e(g)}}).bind(this)).fail((function(f,h,g){if(e){e(null,h)}}).bind(this))};b.__initialize=function(){this.__api("profile/session",{},(function(c){if(!c){console.warn("CreditPiggy: Unable to obtain session information");this.__session=null;return}this.__session=c;if(this.__session.profile){this.profile=this.__session.profile;this.trigger("user",this.profile)}}).bind(this))};b.on=function(d,c){if(!this.__callbacks[d]){this.__callbacks[d]=[]}this.__callbacks[d].push(c);return this};b.off=function(e,d){if(!this.__callbacks[e]){return this}var c=this.__callbacks[e].indexOf(d);if(c<0){return this}this.__callbacks[e].splice(c,1);if(this.__callbacks[e].length==0){delete this.__callbacks[e]}return this};b.trigger=function(){var d=Array.prototype.slice.call(arguments),c=d.shift();if(!this.__callbacks[c]){return}for(var f=0;f<this.__callbacks[c].length;f++){try{this.__callbacks[c].apply(this,d)}catch(g){console.error("CreditPiggy: Error triggering callback ",c);console.error(g.stack)}}return this};a(b.__initialize);return b});